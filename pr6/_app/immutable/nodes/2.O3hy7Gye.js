import{a as b,f as O}from"../chunks/D-0s749m.js";import{P as j,l as E,Y as B,W as q,S as K,X as A,Z as X,$ as Z,V as G,T as k,k as R,U as S,R as $}from"../chunks/CFO0DM1P.js";import{e as C,s as J}from"../chunks/B3UL27d8.js";import{i as Q}from"../chunks/BssfcsMa.js";import{h as ee}from"../chunks/CjodL7ei.js";import{s as h,p as U,v as te}from"../chunks/BHHx8Byi.js";import{g as oe}from"../chunks/BeSk8K1g.js";import{b as L}from"../chunks/CBX61erA.js";import{w as M}from"../chunks/BQ7TfXsn.js";import{i as z}from"../chunks/3WSDg3Ek.js";const ne=!0,be=Object.freeze(Object.defineProperty({__proto__:null,prerender:ne},Symbol.toStringTag,{value:"Module"})),ae={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_APP_BUILD_DATE:"2026-02-11T05:57:24.559Z",VITE_APP_COMMIT_HASH:"aad64fa",VITE_APP_DIRTY_FLAG:!1,VITE_APP_VERSION:"0.0.1",VITE_GOOGLE_OAUTH_ID:"604496276072-po6pvcent5ph93oh569cinl7getgab2f.apps.googleusercontent.com"},se=ae&&"604496276072-po6pvcent5ph93oh569cinl7getgab2f.apps.googleusercontent.com"||void 0,P=["https://www.googleapis.com/auth/userinfo.profile","https://www.googleapis.com/auth/userinfo.email","https://www.googleapis.com/auth/drive.file","https://www.googleapis.com/auth/spreadsheets"].join(" "),l=M({token:null,ready:!1}),re=M(null);let w,s=null,f=null;const D="workouts_access_token",T="workouts_token_expiry",F=300;let _=null,I=null;function ie(t){const e=localStorage.getItem(D),o=localStorage.getItem(T);if(document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&le()}),e&&o){const c=parseInt(o),p=Date.now(),m=2880*60*1e3;if(p<c){s=e,l.update(g=>({...g,token:e})),t(s),z(s),window._authReady=!0,l.update(g=>({...g,ready:!0}));const d=(c-p)/1e3;x(d)}else p<c+m?(window._authReady=!0,l.update(d=>({...d,ready:!0})),y()):(H(),window._authReady=!0,l.update(d=>({...d,ready:!0})))}let i=0;const u=window.google;if(typeof u<"u"&&u.accounts){V(t);return}const v=setInterval(()=>{const c=window.google;typeof c<"u"&&c.accounts?(clearInterval(v),V(t)):(i++,i>50&&(clearInterval(v),console.error("Google Identity Services script failed to load.")))},100)}function V(t){const e=window.google;try{w=e.accounts.oauth2.initTokenClient({client_id:se,scope:P,callback:o=>{ce(o,t)}})}catch(o){console.error("[Auth] initTokenClient failed",o)}window._authReady=!0,l.update(o=>({...o,ready:!0}))}function ce(t,e){if(t.error){console.error("[Auth] Token request failed:",t.error),H(),window.location.href=`${L}/`;return}s=t.access_token;const o=t.expires_in||3599,i=Date.now()+o*1e3;localStorage.setItem(D,s),localStorage.setItem(T,i.toString()),l.update(u=>({...u,token:s})),z(s),I&&(I(s),I=null,_=null),e(s),x(o)}function x(t,e){f&&(clearTimeout(f),f=null);const o=(t-F)*1e3;o<=0?y():f=setTimeout(()=>{y()},o)}function le(t){const e=localStorage.getItem(T);if(!e)return;const i=(parseInt(e)-Date.now())/1e3;i<F?y():x(i)}function y(){return _||(w?(_=new Promise(t=>{I=t}),w.requestAccessToken({prompt:"",scope:P}),_):Promise.resolve(null))}function ue(){w?w.requestAccessToken({prompt:"consent",scope:P}):console.error("Google Identity Services not initialized yet")}function H(){const t=s;s=null,f&&clearTimeout(f),localStorage.removeItem(D),localStorage.removeItem(T),l.update(o=>({...o,token:null}));const e=window.google;typeof e<"u"&&e.accounts&&t&&e.accounts.oauth2.revoke(t,()=>{})}async function de(){if(!s)return null;try{const t=await fetch("https://www.googleapis.com/oauth2/v3/userinfo",{headers:{Authorization:`Bearer ${s}`}});if(t.ok){const e=await t.json();return re.set({name:e.name,email:e.email,picture:e.picture,id:e.sub}),{name:e.name,email:e.email,picture:e.picture,id:e.sub}}}catch(t){console.error("Failed to fetch user info",t)}return null}var fe=O('<div class="auth-container"><button data-testid="sign-in-btn" class="svelte-1uha8ag">Sign In with Google</button></div>'),pe=O('<div class="dashboard-container"><p> </p> <button data-testid="start-workout-btn" class="svelte-1uha8ag">Start Workout</button></div>'),me=O('<main class="svelte-1uha8ag"><h1>Workouts</h1> <!></main>');function Ee(t,e){j(e,!0);let o=A(!1),i=A("User"),u=A(!1);const v=h.subscribe(()=>{const n=h.getState();E(o,n.workout.isAuthenticated,!0),n.workout.user&&E(i,n.workout.user.name,!0)});B(()=>{window.store=h;const n=l.subscribe(async a=>{if(E(u,a.ready,!0),a.token){const r=await de();r&&h.dispatch(U({type:"auth/login",payload:{user:{id:r.id||r.email,name:r.name,email:r.email},timestamp:new Date().toISOString(),accessToken:a.token}}))}});return ie(a=>{console.log("Auth Initialized",a)}),()=>{n()}}),q(()=>{v()});function c(){ue()}function p(){const n=window.__TEST_MODE__?"test-workout-id":te();h.dispatch(U({type:"workout/start",payload:{workoutId:n,timestamp:new Date().toISOString()}})),oe(`${L}/workout/${n}`)}var m=me();ee("1uha8ag",n=>{X(()=>{Z.title="Workouts"})});var d=G(k(m),2);{var g=n=>{var a=fe(),r=k(a);S(a),$(()=>r.disabled=!R(u)),C("click",r,c),b(n,a)},N=n=>{var a=pe(),r=k(a),W=k(r);S(r);var Y=G(r,2);S(a),$(()=>J(W,`Welcome, ${R(i)??""}`)),C("click",Y,p),b(n,a)};Q(d,n=>{R(o)?n(N,!1):n(g)})}S(m),b(t,m),K()}export{Ee as component,be as universal};
