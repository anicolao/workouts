import{s as n,p,e as R}from"./CZh9KMHw.js";const r="Exercise Catalog",y="Instructions",S="Exercise Catalog",C=["Exercise Name","Muscle Group","Default RPE","Tags"],E=[["Incline Press","Push",8,"Chest, Shoulders, Barbell, Dumbbell"],["Dips","Push",9,"Chest, Triceps, Bodyweight"],["Tricep Overhead Extension","Push",9,"Triceps, Cable, Dumbbell"],["Pull-Up","Pull",9,"Back, Lats, Bodyweight"],["Barbell Row","Pull",8,"Back, Thickness, Barbell"],["Face Pull","Pull",9,"Rear Delt, Rotator Cuff, Cable"],["Back Squat","Squat",6,"Quads, Glutes, Barbell"],["Front Squat","Squat",6,"Quads, Core, Barbell"],["Leg Press","Squat",7,"Quads, Machine"],["Deadlift","Hinge",6,"Hamstrings, Posterior Chain, Barbell"],["Romanian Deadlift","Hinge",7,"Hamstrings, Glutes, Barbell"],["Good Morning","Hinge",7,"Hamstrings, Lower Back, Barbell"]],T=[["Workouts App Configuration"],[""],["Welcome to your configuration sheet! This is where you can customize the exercises available in the app."],[""],["How to use:"],['1. Switch to the "Exercise Catalog" tab at the bottom.'],["2. Add new exercises by typing them into a new row."],["3. Edit existing exercises by changing the text."],['4. "Tags" should be separated by commas.'],[""],["IMPORTANT:"],['- Do NOT rename the "Exercise Catalog" sheet.'],["- Do NOT delete the header row (Row 1)."],["- Changes here will be synced to the app the next time you open it."]];let g=null;function D(e){return g||(g=I(e).catch(t=>{throw g=null,t})),g}async function I(e){try{const t=await R(e);if(!t)return null;const l=`mimeType='application/vnd.google-apps.spreadsheet' and '${t}' in parents and trashed=false and (name='${S}' or appProperties has { key='type' and value='exercises_config' })`,c=`https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent(l)}`,o=await(await fetch(c,{headers:{Authorization:`Bearer ${e}`}})).json();let s,h=[];if(o.files&&o.files.length>0)s=o.files[0].id,console.log(`Found existing config sheet: ${s}`),h=(await(await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${s}`,{headers:{Authorization:`Bearer ${e}`}})).json()).sheets||[];else{console.log("Creating new config sheet...");const i=await(await fetch("https://sheets.googleapis.com/v4/spreadsheets",{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({properties:{title:S},sheets:[{properties:{title:y}},{properties:{title:r,gridProperties:{frozenRowCount:1}}}]})})).json();return s=i.spreadsheetId,h=i.sheets,await fetch(`https://www.googleapis.com/drive/v3/files/${s}?addParents=${t}`,{method:"PATCH",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({appProperties:{type:"exercises_config"}})}),await f(e,s,y,T),await f(e,s,r,[C,...E]),s}return h.find(a=>a.properties.title===r)||(console.log("Exercise Catalog tab missing, recreating..."),await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${s}:batchUpdate`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({requests:[{addSheet:{properties:{title:r,gridProperties:{frozenRowCount:1}}}}]})}),await f(e,s,r,[C,...E])),s}catch(t){return console.error("Error ensuring config sheet:",t),null}}async function f(e,t,l,c){await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${t}/values/${l}:append?valueInputOption=USER_ENTERED`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({values:c})})}async function x(e){console.log("Starting config sync..."),n.dispatch(p({type:"sync/start",payload:{timestamp:new Date().toISOString()}}));try{const t=await D(e);if(!t)throw new Error("Could not ensure config sheet");const m=(await(await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${t}/values/${r}!A2:D`,{headers:{Authorization:`Bearer ${e}`}})).json()).values||[],o={};m.forEach(d=>{const[a,i,b,w]=d;a&&(o[a]={name:a,muscleGroup:i||"Other",defaultRpe:parseInt(b)||8,tags:w?w.split(",").map(u=>u.trim()).filter(u=>u.length>0):[]})});const h=n.getState().workout.exercises||{};for(const[d,a]of Object.entries(o))n.dispatch(p({type:"exercise/upsert",payload:{...a,timestamp:new Date().toISOString()}}));console.log("Config sync complete"),n.dispatch(p({type:"sync/success",payload:{timestamp:new Date().toISOString()}}))}catch(t){console.error("Error syncing config:",t),n.dispatch(p({type:"sync/error",payload:{error:String(t),timestamp:new Date().toISOString()}}))}}export{x as s};
