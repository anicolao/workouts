import{s as h,p as f,e as D}from"./DbSUDNKZ.js";const c="Exercise Catalog",C="Instructions",E="Exercise Catalog",R=["Exercise Name","Muscle Group","Default RPE","Tags"],b=[["Incline Press","Push",8,"Chest, Shoulders, Barbell, Dumbbell"],["Dips","Push",9,"Chest, Triceps, Bodyweight"],["Tricep Overhead Extension","Push",9,"Triceps, Cable, Dumbbell"],["Pull-Up","Pull",9,"Back, Lats, Bodyweight"],["Barbell Row","Pull",8,"Back, Thickness, Barbell"],["Face Pull","Pull",9,"Rear Delt, Rotator Cuff, Cable"],["Back Squat","Squat",6,"Quads, Glutes, Barbell"],["Front Squat","Squat",6,"Quads, Core, Barbell"],["Leg Press","Squat",7,"Quads, Machine"],["Deadlift","Hinge",6,"Hamstrings, Posterior Chain, Barbell"],["Romanian Deadlift","Hinge",7,"Hamstrings, Glutes, Barbell"],["Good Morning","Hinge",7,"Hamstrings, Lower Back, Barbell"]],O=[["Workouts App Configuration"],[""],["Welcome to your configuration sheet! This is where you can customize the exercises available in the app."],[""],["How to use:"],['1. Switch to the "Exercise Catalog" tab at the bottom.'],["2. Add new exercises by typing them into a new row."],["3. Edit existing exercises by changing the text."],['4. "Tags" should be separated by commas.'],[""],["IMPORTANT:"],['- Do NOT rename the "Exercise Catalog" sheet.'],["- Do NOT delete the header row (Row 1)."],["- Changes here will be synced to the app the next time you open it."]];let m=null;function P(e){return m||(m=x(e).catch(s=>{throw m=null,s})),m}async function x(e){try{const s=await D(e);if(!s)return null;const u=`mimeType='application/vnd.google-apps.spreadsheet' and '${s}' in parents and trashed=false and (name='${E}' or appProperties has { key='type' and value='exercises_config' })`,g=`https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent(u)}`,i=await(await fetch(g,{headers:{Authorization:`Bearer ${e}`}})).json();let a,p=[];if(i.files&&i.files.length>0)a=i.files[0].id,console.log(`Found existing config sheet: ${a}`),p=(await(await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${a}`,{headers:{Authorization:`Bearer ${e}`}})).json()).sheets||[];else{console.log("Creating new config sheet...");const o=await(await fetch("https://sheets.googleapis.com/v4/spreadsheets",{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({properties:{title:E},sheets:[{properties:{title:C}},{properties:{title:c,gridProperties:{frozenRowCount:1}}}]})})).json();return a=o.spreadsheetId,p=o.sheets,await fetch(`https://www.googleapis.com/drive/v3/files/${a}?addParents=${s}`,{method:"PATCH",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({appProperties:{type:"exercises_config"}})}),await y(e,a,C,O),await y(e,a,c,[R,...b]),a}return p.find(t=>t.properties.title===c)||(console.log("Exercise Catalog tab missing, recreating..."),await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${a}:batchUpdate`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({requests:[{addSheet:{properties:{title:c,gridProperties:{frozenRowCount:1}}}}]})}),await y(e,a,c,[R,...b])),a}catch(s){return console.error("Error ensuring config sheet:",s),null}}async function y(e,s,u,g){await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${s}/values/${u}:append?valueInputOption=USER_ENTERED`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({values:g})})}async function B(e){console.log("Starting config sync..."),h.dispatch(f({type:"sync/start",payload:{timestamp:new Date().toISOString()}}));try{const s=await P(e);if(!s)throw new Error("Could not ensure config sheet");const w=(await(await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${s}/values/${c}!A2:D`,{headers:{Authorization:`Bearer ${e}`}})).json()).values||[],i={};w.forEach(n=>{const[t,o,d,l]=n;t&&(i[t]={name:t,muscleGroup:o||"Other",defaultRpe:parseInt(d)||8,tags:l?l.split(",").map(r=>r.trim()).filter(r=>r.length>0):[]})});const p=h.getState().workout.exercises||{};for(const[n,t]of Object.entries(i)){const o=p[n];let d=!0;if(o){const l=[...t.tags].sort(),r=[...o.tags].sort(),S=r.length===l.length&&r.every((T,$)=>T===l[$]);o.muscleGroup===t.muscleGroup&&o.defaultRpe===t.defaultRpe&&S?d=!1:(console.log(`Diff for ${n}:`),o.muscleGroup!==t.muscleGroup&&console.log(`  Muscle: ${o.muscleGroup} != ${t.muscleGroup}`),o.defaultRpe!==t.defaultRpe&&console.log(`  RPE: ${o.defaultRpe} != ${t.defaultRpe}`),S||console.log(`  Tags: ${JSON.stringify(r)} != ${JSON.stringify(l)}`))}else console.log(`New exercise found: ${n}`);d&&h.dispatch(f({type:"exercise/upsert",payload:{...t,timestamp:new Date().toISOString()}}))}console.log("Config sync complete"),h.dispatch(f({type:"sync/success",payload:{timestamp:new Date().toISOString()}}))}catch(s){console.error("Error syncing config:",s),h.dispatch(f({type:"sync/error",payload:{error:String(s),timestamp:new Date().toISOString()}}))}}export{B as s};
