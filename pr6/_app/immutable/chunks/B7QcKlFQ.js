import{s as n,p as h,e as b}from"./BSVIHW6R.js";const r="Exercise Catalog",w="Instructions",y="Exercise Catalog",S=["Exercise Name","Muscle Group","Default RPE","Tags"],E=[["Incline Press","Push",8,"Chest, Shoulders, Barbell, Dumbbell"],["Dips","Push",9,"Chest, Triceps, Bodyweight"],["Tricep Overhead Extension","Push",9,"Triceps, Cable, Dumbbell"],["Pull-Up","Pull",9,"Back, Lats, Bodyweight"],["Barbell Row","Pull",8,"Back, Thickness, Barbell"],["Face Pull","Pull",9,"Rear Delt, Rotator Cuff, Cable"],["Back Squat","Squat",6,"Quads, Glutes, Barbell"],["Front Squat","Squat",6,"Quads, Core, Barbell"],["Leg Press","Squat",7,"Quads, Machine"],["Deadlift","Hinge",6,"Hamstrings, Posterior Chain, Barbell"],["Romanian Deadlift","Hinge",7,"Hamstrings, Glutes, Barbell"],["Good Morning","Hinge",7,"Hamstrings, Lower Back, Barbell"]],R=[["Workouts App Configuration"],[""],["Welcome to your configuration sheet! This is where you can customize the exercises available in the app."],[""],["How to use:"],['1. Switch to the "Exercise Catalog" tab at the bottom.'],["2. Add new exercises by typing them into a new row."],["3. Edit existing exercises by changing the text."],['4. "Tags" should be separated by commas.'],[""],["IMPORTANT:"],['- Do NOT rename the "Exercise Catalog" sheet.'],["- Do NOT delete the header row (Row 1)."],["- Changes here will be synced to the app the next time you open it."]];async function T(e){try{const t=await b(e);if(!t)return null;const c=`mimeType='application/vnd.google-apps.spreadsheet' and '${t}' in parents and trashed=false and (name='${y}' or appProperties has { key='type' and value='exercises_config' })`,l=`https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent(c)}`,o=await(await fetch(l,{headers:{Authorization:`Bearer ${e}`}})).json();let s,p=[];if(o.files&&o.files.length>0)s=o.files[0].id,console.log(`Found existing config sheet: ${s}`),p=(await(await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${s}`,{headers:{Authorization:`Bearer ${e}`}})).json()).sheets||[];else{console.log("Creating new config sheet...");const i=await(await fetch("https://sheets.googleapis.com/v4/spreadsheets",{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({properties:{title:y},sheets:[{properties:{title:w}},{properties:{title:r,gridProperties:{frozenRowCount:1}}}]})})).json();return s=i.spreadsheetId,p=i.sheets,await fetch(`https://www.googleapis.com/drive/v3/files/${s}?addParents=${t}`,{method:"PATCH",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({appProperties:{type:"exercises_config"}})}),await u(e,s,w,R),await u(e,s,r,[S,...E]),s}return p.find(a=>a.properties.title===r)||(console.log("Exercise Catalog tab missing, recreating..."),await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${s}:batchUpdate`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({requests:[{addSheet:{properties:{title:r,gridProperties:{frozenRowCount:1}}}}]})}),await u(e,s,r,[S,...E])),s}catch(t){return console.error("Error ensuring config sheet:",t),null}}async function u(e,t,c,l){await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${t}/values/${c}:append?valueInputOption=USER_ENTERED`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({values:l})})}async function I(e){console.log("Starting config sync..."),n.dispatch(h({type:"sync/start",payload:{timestamp:new Date().toISOString()}}));try{const t=await T(e);if(!t)throw new Error("Could not ensure config sheet");const f=(await(await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${t}/values/${r}!A2:D`,{headers:{Authorization:`Bearer ${e}`}})).json()).values||[],o={};f.forEach(g=>{const[a,i,C,m]=g;a&&(o[a]={name:a,muscleGroup:i||"Other",defaultRpe:parseInt(C)||8,tags:m?m.split(",").map(d=>d.trim()).filter(d=>d.length>0):[]})});const p=n.getState().workout.exercises||{};for(const[g,a]of Object.entries(o))n.dispatch(h({type:"exercise/upsert",payload:{...a,timestamp:new Date().toISOString()}}));console.log("Config sync complete"),n.dispatch(h({type:"sync/success",payload:{timestamp:new Date().toISOString()}}))}catch(t){console.error("Error syncing config:",t),n.dispatch(h({type:"sync/error",payload:{error:String(t),timestamp:new Date().toISOString()}}))}}export{I as s};
