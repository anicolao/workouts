import{s as c,p as f,e as D}from"./C7_BxJEm.js";const i="Exercise Catalog",S="Instructions",C="Exercise Catalog",E=["Exercise Name","Muscle Group","Default RPE","Tags"],b=[["Incline Press","Push",8,"Chest, Shoulders, Barbell, Dumbbell"],["Dips","Push",9,"Chest, Triceps, Bodyweight"],["Tricep Overhead Extension","Push",9,"Triceps, Cable, Dumbbell"],["Pull-Up","Pull",9,"Back, Lats, Bodyweight"],["Barbell Row","Pull",8,"Back, Thickness, Barbell"],["Face Pull","Pull",9,"Rear Delt, Rotator Cuff, Cable"],["Back Squat","Squat",6,"Quads, Glutes, Barbell"],["Front Squat","Squat",6,"Quads, Core, Barbell"],["Leg Press","Squat",7,"Quads, Machine"],["Deadlift","Hinge",6,"Hamstrings, Posterior Chain, Barbell"],["Romanian Deadlift","Hinge",7,"Hamstrings, Glutes, Barbell"],["Good Morning","Hinge",7,"Hamstrings, Lower Back, Barbell"]],T=[["Workouts App Configuration"],[""],["Welcome to your configuration sheet! This is where you can customize the exercises available in the app."],[""],["How to use:"],['1. Switch to the "Exercise Catalog" tab at the bottom.'],["2. Add new exercises by typing them into a new row."],["3. Edit existing exercises by changing the text."],['4. "Tags" should be separated by commas.'],[""],["IMPORTANT:"],['- Do NOT rename the "Exercise Catalog" sheet.'],["- Do NOT delete the header row (Row 1)."],["- Changes here will be synced to the app the next time you open it."]];let m=null;function I(e){return m||(m=P(e).catch(t=>{throw m=null,t})),m}async function P(e){try{const t=await D(e);if(!t)return null;const p=`mimeType='application/vnd.google-apps.spreadsheet' and '${t}' in parents and trashed=false and (name='${C}' or appProperties has { key='type' and value='exercises_config' })`,h=`https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent(p)}`,r=await(await fetch(h,{headers:{Authorization:`Bearer ${e}`}})).json();let a,n=[];if(r.files&&r.files.length>0)a=r.files[0].id,console.log(`Found existing config sheet: ${a}`),n=(await(await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${a}`,{headers:{Authorization:`Bearer ${e}`}})).json()).sheets||[];else{console.log("Creating new config sheet...");const o=await(await fetch("https://sheets.googleapis.com/v4/spreadsheets",{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({properties:{title:C},sheets:[{properties:{title:S}},{properties:{title:i,gridProperties:{frozenRowCount:1}}}]})})).json();return a=o.spreadsheetId,n=o.sheets,await fetch(`https://www.googleapis.com/drive/v3/files/${a}?addParents=${t}`,{method:"PATCH",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({appProperties:{type:"exercises_config"}})}),await w(e,a,S,T),await w(e,a,i,[E,...b]),a}return n.find(s=>s.properties.title===i)||(console.log("Exercise Catalog tab missing, recreating..."),await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${a}:batchUpdate`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({requests:[{addSheet:{properties:{title:i,gridProperties:{frozenRowCount:1}}}}]})}),await w(e,a,i,[E,...b])),a}catch(t){return console.error("Error ensuring config sheet:",t),null}}async function w(e,t,p,h){await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${t}/values/${p}:append?valueInputOption=USER_ENTERED`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({values:h})})}async function O(e){console.log("Starting config sync..."),c.dispatch(f({type:"sync/start",payload:{timestamp:new Date().toISOString()}}));try{const t=await I(e);if(!t)throw new Error("Could not ensure config sheet");const y=(await(await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${t}/values/${i}!A2:D`,{headers:{Authorization:`Bearer ${e}`}})).json()).values||[],r={};y.forEach(g=>{const[s,o,u,d]=g;s&&(r[s]={name:s,muscleGroup:o||"Other",defaultRpe:parseInt(u)||8,tags:d?d.split(",").map(l=>l.trim()).filter(l=>l.length>0):[]})});const n=c.getState().workout.exercises||{};for(const[g,s]of Object.entries(r)){const o=n[g];let u=!0;if(o){const d=o.tags.length===s.tags.length&&o.tags.every((l,R)=>l===s.tags[R]);o.muscleGroup===s.muscleGroup&&o.defaultRpe===s.defaultRpe&&d&&(u=!1)}u&&c.dispatch(f({type:"exercise/upsert",payload:{...s,timestamp:new Date().toISOString()}}))}console.log("Config sync complete"),c.dispatch(f({type:"sync/success",payload:{timestamp:new Date().toISOString()}}))}catch(t){console.error("Error syncing config:",t),c.dispatch(f({type:"sync/error",payload:{error:String(t),timestamp:new Date().toISOString()}}))}}export{O as s};
