import{e as I,s as f,p as R,g as H}from"./BS3m1cc_.js";const N="Programs",A="Starting Strength",_=["Day Name","Exercise Name","Load","Rep Range","RPE","Notes"],P=[["Day A","Back Squat","","3x5","8",""],["Day A","Overhead Press","","3x5","8",""],["Day A","Deadlift","","1x5","9",""]],O=[["Day B","Back Squat","","3x5","8",""],["Day B","Bench Press","","3x5","8",""],["Day B","Power Clean","","5x3","8",""]],z=[_,...P,...O,...P],j=[_,...O,...P,...O],G=z,L=j;async function U(e){const t=await I(e);if(!t)return null;const o=`name='${N}' and '${t}' in parents and mimeType='application/vnd.google-apps.folder' and trashed=false`,n=`https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent(o)}`,r=await(await fetch(n,{headers:{Authorization:`Bearer ${e}`}})).json();return r.files&&r.files.length>0?r.files[0].id:(await(await fetch("https://www.googleapis.com/drive/v3/files",{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({name:N,mimeType:"application/vnd.google-apps.folder",parents:[t]})})).json()).id}async function C(e,t,o,n){await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${t}/values/${o}:append?valueInputOption=USER_ENTERED`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({values:n})})}async function M(e){const t=await U(e);if(!t)return null;const o=`name='${A}' and '${t}' in parents and mimeType='application/vnd.google-apps.spreadsheet' and trashed=false`,n=`https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent(o)}`,r=await(await fetch(n,{headers:{Authorization:`Bearer ${e}`}})).json();if(r.files&&r.files.length>0)return r.files[0].id;console.log("Creating Starting Strength program...");const s=(await(await fetch("https://sheets.googleapis.com/v4/spreadsheets",{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({properties:{title:A},sheets:[{properties:{title:"Week 1",gridProperties:{frozenRowCount:1}}},{properties:{title:"Week 2",gridProperties:{frozenRowCount:1}}},{properties:{title:"Week 3",gridProperties:{frozenRowCount:1}}},{properties:{title:"Week 4",gridProperties:{frozenRowCount:1}}}]})})).json()).spreadsheetId;return await fetch(`https://www.googleapis.com/drive/v3/files/${s}?addParents=${t}`,{method:"PATCH",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({})}),await C(e,s,"Week 1",z),await C(e,s,"Week 2",j),await C(e,s,"Week 3",G),await C(e,s,"Week 4",L),s}async function J(e){const t=await U(e);if(!t)return[];const o=`'${t}' in parents and mimeType='application/vnd.google-apps.spreadsheet' and trashed=false`,n=`https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent(o)}&fields=files(id,name)`,a=(await(await fetch(n,{headers:{Authorization:`Bearer ${e}`}})).json()).files||[],i=[];for(const s of a)try{const p=await K(e,s.id,s.name);i.push(p)}catch(p){console.error(`Failed to parse program ${s.name} (${s.id}):`,p)}return i}async function K(e,t,o){const r=(await(await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${t}?fields=sheets(properties(title))`,{headers:{Authorization:`Bearer ${e}`}})).json()).sheets||[],a={id:t,name:o,weeks:[]};for(const i of r){const s=i.properties.title;if(s.startsWith("_"))continue;const p=`${s}!A2:F`,m=`https://sheets.googleapis.com/v4/spreadsheets/${t}/values/${encodeURIComponent(p)}`,d=(await(await fetch(m,{headers:{Authorization:`Bearer ${e}`}})).json()).values||[],u={name:s,days:[]};let l=null;for(const g of d){const[S,E,D,W,F,q]=g;!S||!E||((!l||l.dayName!==S)&&(l={dayName:S,exercises:[]},u.days.push(l)),l.exercises.push({name:E,load:D||"",reps:W||"",rpe:F||"",notes:q||""}))}a.weeks.push(u)}return a}const w="Exercise Catalog",T="Instructions",B="Exercise Catalog",b=["Exercise Name","Muscle Group","Default RPE","Tags"],x=[["Incline Press","Push",8,"Chest, Shoulders, Barbell, Dumbbell"],["Dips","Push",9,"Chest, Triceps, Bodyweight"],["Tricep Overhead Extension","Push",9,"Triceps, Cable, Dumbbell"],["Pull-Up","Pull",9,"Back, Lats, Bodyweight"],["Barbell Row","Pull",8,"Back, Thickness, Barbell"],["Face Pull","Pull",9,"Rear Delt, Rotator Cuff, Cable"],["Back Squat","Squat",6,"Quads, Glutes, Barbell"],["Front Squat","Squat",6,"Quads, Core, Barbell"],["Leg Press","Squat",7,"Quads, Machine"],["Deadlift","Hinge",6,"Hamstrings, Posterior Chain, Barbell"],["Romanian Deadlift","Hinge",7,"Hamstrings, Glutes, Barbell"],["Good Morning","Hinge",7,"Hamstrings, Lower Back, Barbell"]],Q=[["Workouts App Configuration"],[""],["Welcome to your configuration sheet! This is where you can customize the exercises available in the app."],[""],["How to use:"],['1. Switch to the "Exercise Catalog" tab at the bottom.'],["2. Add new exercises by typing them into a new row."],["3. Edit existing exercises by changing the text."],['4. "Tags" should be separated by commas.'],[""],["IMPORTANT:"],['- Do NOT rename the "Exercise Catalog" sheet.'],["- Do NOT delete the header row (Row 1)."],["- Changes here will be synced to the app the next time you open it."]];let $=null;function k(e){return $||($=X(e).catch(t=>{throw $=null,t})),$}async function X(e){try{const t=await I(e);if(!t)return null;const o=`mimeType='application/vnd.google-apps.spreadsheet' and '${t}' in parents and trashed=false and (name='${B}' or appProperties has { key='type' and value='exercises_config' })`,n=`https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent(o)}`,r=await(await fetch(n,{headers:{Authorization:`Bearer ${e}`}})).json();let a,i=[];if(r.files&&r.files.length>0)a=r.files[0].id,console.log(`Found existing config sheet: ${a}`),i=(await(await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${a}`,{headers:{Authorization:`Bearer ${e}`}})).json()).sheets||[];else{console.log("Creating new config sheet...");const m=await(await fetch("https://sheets.googleapis.com/v4/spreadsheets",{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({properties:{title:B},sheets:[{properties:{title:T}},{properties:{title:w,gridProperties:{frozenRowCount:1}}}]})})).json();return a=m.spreadsheetId,i=m.sheets,await fetch(`https://www.googleapis.com/drive/v3/files/${a}?addParents=${t}`,{method:"PATCH",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({appProperties:{type:"exercises_config"}})}),await v(e,a,T,Q),await v(e,a,w,[b,...x]),a}return i.find(p=>p.properties.title===w)||(console.log("Exercise Catalog tab missing, recreating..."),await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${a}:batchUpdate`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({requests:[{addSheet:{properties:{title:w,gridProperties:{frozenRowCount:1}}}}]})}),await v(e,a,w,[b,...x])),a}catch(t){return console.error("Error ensuring config sheet:",t),null}}async function v(e,t,o,n){await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${t}/values/${o}:append?valueInputOption=USER_ENTERED`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({values:n})})}async function Y(e){console.log("Starting initialization and sync..."),f.dispatch(R({type:"sync/start",payload:{timestamp:new Date().toISOString()}}));try{M(e).then(c=>{c&&console.log(`Starting Strength program ensured: ${c}`)}).catch(c=>console.error("Error ensuring Starting Strength:",c)),console.log("Replaying action log...");const t=await H(e);console.log(`Found ${t.length} actions to replay.`),t.forEach(c=>{f.dispatch({type:"workout/processEvent",payload:c.payload,meta:{replay:!0}})}),console.log("Action replay complete."),console.log("Syncing config sheet...");const o=await k(e);if(!o)throw new Error("Could not ensure config sheet");const r=(await(await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${o}/values/${w}!A2:D`,{headers:{Authorization:`Bearer ${e}`}})).json()).values||[],a={};r.forEach(c=>{const[h,d,u,l]=c;h&&(a[h]={name:h,muscleGroup:d||"Other",defaultRpe:parseInt(u)||8,tags:l?l.split(",").map(g=>g.trim()).filter(g=>g.length>0):[]})});const i=f.getState(),s=i.workout.exercises||{};console.log(`Current app exercises: ${Object.keys(s).length}`);for(const[c,h]of Object.entries(a)){const d=s[c];let u=!0;if(d){const l=[...h.tags].sort(),g=[...d.tags].sort(),S=g.length===l.length&&g.every((E,D)=>E===l[D]);d.muscleGroup===h.muscleGroup&&d.defaultRpe===h.defaultRpe&&S&&(u=!1)}u&&f.dispatch(R({type:"exercise/upsert",payload:{...h,timestamp:new Date().toISOString()}}))}console.log("Syncing programs...");const p=await J(e),m=i.workout.programs||{};for(const c of p)f.dispatch(R({type:"program/upsert",payload:c}));console.log(`Synced ${p.length} programs.`),console.log("Config and Program sync complete"),f.dispatch(R({type:"sync/success",payload:{timestamp:new Date().toISOString()}}))}catch(t){console.error("Error in initialization/sync:",t),f.dispatch(R({type:"sync/error",payload:{error:String(t),timestamp:new Date().toISOString()}}))}}export{Y as i};
