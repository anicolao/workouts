import{s as c,p as f,g as O,e as x}from"./BHHx8Byi.js";const p="Exercise Catalog",E="Instructions",R="Exercise Catalog",C=["Exercise Name","Muscle Group","Default RPE","Tags"],b=[["Incline Press","Push",8,"Chest, Shoulders, Barbell, Dumbbell"],["Dips","Push",9,"Chest, Triceps, Bodyweight"],["Tricep Overhead Extension","Push",9,"Triceps, Cable, Dumbbell"],["Pull-Up","Pull",9,"Back, Lats, Bodyweight"],["Barbell Row","Pull",8,"Back, Thickness, Barbell"],["Face Pull","Pull",9,"Rear Delt, Rotator Cuff, Cable"],["Back Squat","Squat",6,"Quads, Glutes, Barbell"],["Front Squat","Squat",6,"Quads, Core, Barbell"],["Leg Press","Squat",7,"Quads, Machine"],["Deadlift","Hinge",6,"Hamstrings, Posterior Chain, Barbell"],["Romanian Deadlift","Hinge",7,"Hamstrings, Glutes, Barbell"],["Good Morning","Hinge",7,"Hamstrings, Lower Back, Barbell"]],P=[["Workouts App Configuration"],[""],["Welcome to your configuration sheet! This is where you can customize the exercises available in the app."],[""],["How to use:"],['1. Switch to the "Exercise Catalog" tab at the bottom.'],["2. Add new exercises by typing them into a new row."],["3. Edit existing exercises by changing the text."],['4. "Tags" should be separated by commas.'],[""],["IMPORTANT:"],['- Do NOT rename the "Exercise Catalog" sheet.'],["- Do NOT delete the header row (Row 1)."],["- Changes here will be synced to the app the next time you open it."]];let y=null;function I(e){return y||(y=B(e).catch(s=>{throw y=null,s})),y}async function B(e){try{const s=await x(e);if(!s)return null;const n=`mimeType='application/vnd.google-apps.spreadsheet' and '${s}' in parents and trashed=false and (name='${R}' or appProperties has { key='type' and value='exercises_config' })`,g=`https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent(n)}`,h=await(await fetch(g,{headers:{Authorization:`Bearer ${e}`}})).json();let o,u=[];if(h.files&&h.files.length>0)o=h.files[0].id,console.log(`Found existing config sheet: ${o}`),u=(await(await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${o}`,{headers:{Authorization:`Bearer ${e}`}})).json()).sheets||[];else{console.log("Creating new config sheet...");const t=await(await fetch("https://sheets.googleapis.com/v4/spreadsheets",{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({properties:{title:R},sheets:[{properties:{title:E}},{properties:{title:p,gridProperties:{frozenRowCount:1}}}]})})).json();return o=t.spreadsheetId,u=t.sheets,await fetch(`https://www.googleapis.com/drive/v3/files/${o}?addParents=${s}`,{method:"PATCH",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({appProperties:{type:"exercises_config"}})}),await w(e,o,E,P),await w(e,o,p,[C,...b]),o}return u.find(a=>a.properties.title===p)||(console.log("Exercise Catalog tab missing, recreating..."),await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${o}:batchUpdate`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({requests:[{addSheet:{properties:{title:p,gridProperties:{frozenRowCount:1}}}}]})}),await w(e,o,p,[C,...b])),o}catch(s){return console.error("Error ensuring config sheet:",s),null}}async function w(e,s,n,g){await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${s}/values/${n}:append?valueInputOption=USER_ENTERED`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({values:g})})}async function N(e){console.log("Starting initialization and sync..."),c.dispatch(f({type:"sync/start",payload:{timestamp:new Date().toISOString()}}));try{console.log("Replaying action log...");const s=await O(e);console.log(`Found ${s.length} actions to replay.`),s.forEach(a=>{c.dispatch({type:"workout/processEvent",payload:a.payload,meta:{replay:!0}})}),console.log("Action replay complete."),console.log("Syncing config sheet...");const n=await I(e);if(!n)throw new Error("Could not ensure config sheet");const h=(await(await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${n}/values/${p}!A2:D`,{headers:{Authorization:`Bearer ${e}`}})).json()).values||[],o={};h.forEach(a=>{const[t,r,d,l]=a;t&&(o[t]={name:t,muscleGroup:r||"Other",defaultRpe:parseInt(d)||8,tags:l?l.split(",").map(i=>i.trim()).filter(i=>i.length>0):[]})});const m=c.getState().workout.exercises||{};console.log(`Current app exercises: ${Object.keys(m).length}`);for(const[a,t]of Object.entries(o)){const r=m[a];let d=!0;if(r){const l=[...t.tags].sort(),i=[...r.tags].sort(),S=i.length===l.length&&i.every((T,D)=>T===l[D]);r.muscleGroup===t.muscleGroup&&r.defaultRpe===t.defaultRpe&&S?d=!1:(console.log(`Diff for ${a}:`),r.muscleGroup!==t.muscleGroup&&console.log(`  Muscle: ${r.muscleGroup} != ${t.muscleGroup}`),r.defaultRpe!==t.defaultRpe&&console.log(`  RPE: ${r.defaultRpe} != ${t.defaultRpe}`),S||console.log(`  Tags: ${JSON.stringify(i)} != ${JSON.stringify(l)}`))}else console.log(`New exercise found: ${a}`);d&&c.dispatch(f({type:"exercise/upsert",payload:{...t,timestamp:new Date().toISOString()}}))}console.log("Config sync complete"),c.dispatch(f({type:"sync/success",payload:{timestamp:new Date().toISOString()}}))}catch(s){console.error("Error in initialization/sync:",s),c.dispatch(f({type:"sync/error",payload:{error:String(s),timestamp:new Date().toISOString()}}))}}export{N as i};
